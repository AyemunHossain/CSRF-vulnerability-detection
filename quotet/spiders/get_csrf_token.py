
import scrapy
import os
BASE_DIR = os.getcwd()


class GetCSRFtoken(scrapy.Spider):
    """
    From login page extract the csrf token value
    """

    name = "GetCSRFtoken"


    def _get_url(self):

        file= open("url.txt","r")
        try:
            return file.readline()
        except:
            return None


    def __init__(self, config_file = None, *args, **kwargs):                    
        super(GetCSRFtoken, self).__init__(*args, **kwargs)   
        self.start_urls = [self._get_url()]
    

    def start_requests(self):
        for url in self.start_urls:
            yield scrapy.Request(url=url, callback=self.parse)


    def parse(self, response, **kwargs):
        token = response.css('form input::attr(value)').extract_first()
        with open("tokens.txt", "a") as f:
            f.write(f"{token}\n")
            f.close()